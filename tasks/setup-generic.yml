- name: Ensure dependencies are installed.
  package:
    name: curl
    state: present

- name: Install Kubernetes packages.
  package:
    name: "{{ item.name | default(item) }}"
    state: "{{ item.state | default('present') }}"
  notify: restart kubelet
  with_items: "{{ kubernetes_packages }}"
  become: yes

- include_tasks: kubelet-setup.yml

- name: Ensure kubelet is started and enabled at boot.
  service:
    name: kubelet
    state: started
    enabled: true

- name: "kubeadm | Check of the existence of kubeadm config"
  include_tasks: kubeadm-check.yml
